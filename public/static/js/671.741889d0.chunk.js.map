{"version":3,"file":"static/js/671.741889d0.chunk.js","mappings":"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","sources":["GamesCommon.js","pages/games/Favorites.js"],"sourcesContent":["import { useState } from 'react';\nimport { Link } from 'react-router-dom';\nimport { Obfuscated } from './obfuscate.js';\nimport { resolveRoute } from './Routes.js';\n\n/**\n *\n * @typedef {object} GamesCategoryParams\n * @property {boolean} [leastGreatest]\n * @property {string} [category]\n * @property {string} [sort]\n * @property {string} [search]\n * @property {number} [limit]\n * @property {number} [limitPerCategory]\n */\n\n/**\n *\n * @typedef {object} LimitedGame\n * @property {string} name\n * @property {string} id\n * @property {string} category\n */\n\n/**\n *\n * @typedef {LimitedGame[]} GamesCategory\n */\n\nexport class GamesAPI {\n\tconstructor(server) {\n\t\tthis.server = server;\n\t}\n\tasync game(id) {\n\t\tconst outgoing = await fetch(new URL(`./games/${id}/`, this.server));\n\n\t\tif (!outgoing.ok) {\n\t\t\tthrow await outgoing.json();\n\t\t}\n\n\t\treturn await outgoing.json();\n\t}\n\tasync game_plays(id, token) {\n\t\tconst outgoing = await fetch(\n\t\t\tnew URL(\n\t\t\t\t`./games/${id}/plays?` +\n\t\t\t\t\tnew URLSearchParams({\n\t\t\t\t\t\ttoken,\n\t\t\t\t\t}),\n\t\t\t\tthis.server\n\t\t\t),\n\t\t\t{\n\t\t\t\tmethod: 'PUT',\n\t\t\t}\n\t\t);\n\n\t\tif (!outgoing.ok) {\n\t\t\tthrow await outgoing.json();\n\t\t}\n\n\t\treturn await outgoing.json();\n\t}\n\tsort_params(params) {\n\t\tfor (let param in params) {\n\t\t\tswitch (typeof params[param]) {\n\t\t\t\tcase 'undefined':\n\t\t\t\tcase 'object':\n\t\t\t\t\tdelete params[param];\n\t\t\t\t\tbreak;\n\t\t\t\t// no default\n\t\t\t}\n\t\t}\n\n\t\treturn params;\n\t}\n\t/**\n\t *\n\t * @param {GamesCategoryParams} params\n\t * @param {AbortSignal} signal\n\t * @returns {GamesCategory}\n\t */\n\tasync category(params, signal) {\n\t\tconst outgoing = await fetch(\n\t\t\tnew URL(\n\t\t\t\t'./games/?' + new URLSearchParams(this.sort_params(params)),\n\t\t\t\tthis.server\n\t\t\t),\n\t\t\t{ signal }\n\t\t);\n\n\t\tif (!outgoing.ok) {\n\t\t\tthrow await outgoing.json();\n\t\t}\n\n\t\treturn await outgoing.json();\n\t}\n}\n\nexport function Item(props) {\n\tconst [loaded, set_loaded] = useState(false);\n\n\treturn (\n\t\t<Link\n\t\t\tto={`${resolveRoute('/games/', 'player')}?id=${props.id}`}\n\t\t\tonClick={() => props.layout.current.setState({ expanded: false })}\n\t\t>\n\t\t\t<div className=\"item\">\n\t\t\t\t<div className=\"thumbnail\">\n\t\t\t\t\t<img\n\t\t\t\t\t\talt=\"\"\n\t\t\t\t\t\tloading=\"lazy\"\n\t\t\t\t\t\tonLoad={() => set_loaded(true)}\n\t\t\t\t\t\tdata-loaded={Number(loaded)}\n\t\t\t\t\t\tsrc={`/thumbnails/${props.id}.webp`}\n\t\t\t\t\t></img>\n\t\t\t\t</div>\n\t\t\t\t<div className=\"name\">\n\t\t\t\t\t<Obfuscated ellipsis>{props.name}</Obfuscated>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</Link>\n\t);\n}\n\nexport function LoadingItem(props) {\n\treturn (\n\t\t<div className=\"item loading\">\n\t\t\t<div className=\"thumbnail\" />\n\t\t\t<div className=\"name\" />\n\t\t</div>\n\t);\n}\n\nexport function ItemList(props) {\n\tconst items = [];\n\n\tfor (let item of props.items) {\n\t\tif (item.loading) {\n\t\t\titems.push(\n\t\t\t\t<LoadingItem key={item.id} id={item.id} layout={props.layout} />\n\t\t\t);\n\t\t} else {\n\t\t\titems.push(\n\t\t\t\t<Item\n\t\t\t\t\tkey={item.id}\n\t\t\t\t\tid={item.id}\n\t\t\t\t\tname={item.name}\n\t\t\t\t\tlayout={props.layout}\n\t\t\t\t/>\n\t\t\t);\n\t\t}\n\t}\n\n\treturn items;\n}\n\nexport function Section(props) {\n\treturn (\n\t\t<section>\n\t\t\t<div className=\"name\">\n\t\t\t\t<h1>{props.name}</h1>\n\t\t\t</div>\n\t\t\t<div className=\"items\">\n\t\t\t\t<ItemList items={props.items} layout={props.layout} />\n\t\t\t</div>\n\t\t</section>\n\t);\n}\n","import { Component } from 'react';\nimport { DB_API, set_page } from '../../root.js';\nimport { GamesAPI, Section } from '../../GamesCommon.js';\nimport Settings from '../../Settings.js';\nimport '../../styles/GamesCategory.scss';\n\nconst FETCH_FAILED = /TypeError: Failed to fetch/;\n\nexport default class FavoritesCategory extends Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\n\t\tconst data = [];\n\n\t\tfor (let id of this.set_favorites) {\n\t\t\tdata.push({\n\t\t\t\tloading: true,\n\t\t\t\tid,\n\t\t\t});\n\t\t}\n\n\t\tthis.state = {\n\t\t\tdata,\n\t\t};\n\t}\n\tapi = new GamesAPI(DB_API);\n\tsettings = new Settings('common games', {\n\t\tfavorites: [],\n\t\tseen: [],\n\t});\n\tabort = new AbortController();\n\t/**\n\t * @returns {import('react').Ref<import('../../GamesLayout.js').default>}\n\t */\n\tget layout() {\n\t\treturn this.props.layout;\n\t}\n\tget set_favorites() {\n\t\treturn this.settings.get('favorites');\n\t}\n\tasync fetch() {\n\t\tconst data = [];\n\n\t\tconst favorites = this.set_favorites;\n\n\t\tfor (let id of favorites) {\n\t\t\ttry {\n\t\t\t\tdata.push(await this.api.game(id));\n\t\t\t} catch (error) {\n\t\t\t\t// cancelled? page unload?\n\t\t\t\tif (!FETCH_FAILED.test(error)) {\n\t\t\t\t\tconsole.warn('Unable to fetch game:', id, error);\n\t\t\t\t\tfavorites.splice(favorites.indexOf(id), 1);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.settings.set('favorites', favorites);\n\n\t\treturn this.setState({\n\t\t\tdata,\n\t\t});\n\t}\n\tcomponentDidMount() {\n\t\tthis.fetch();\n\t}\n\tcomponentWillUnmount() {\n\t\tthis.abort.abort();\n\t}\n\trender() {\n\t\tset_page('games-category');\n\n\t\tif (this.set_favorites.length === 0) {\n\t\t\treturn (\n\t\t\t\t<main>\n\t\t\t\t\t<span className=\"no-games\">\n\t\t\t\t\t\tYou haven't added any favorite games.\n\t\t\t\t\t</span>\n\t\t\t\t</main>\n\t\t\t);\n\t\t} else {\n\t\t\treturn (\n\t\t\t\t<main>\n\t\t\t\t\t<Section\n\t\t\t\t\t\tname=\"Favorites\"\n\t\t\t\t\t\titems={this.state.data}\n\t\t\t\t\t\tlayout={this.layout}\n\t\t\t\t\t/>\n\t\t\t\t</main>\n\t\t\t);\n\t\t}\n\t}\n}\n"],"names":["GamesAPI","server","this","id","fetch","URL","outgoing","ok","json","token","URLSearchParams","method","params","param","signal","sort_params","Item","props","useState","loaded","set_loaded","to","resolveRoute","onClick","layout","current","setState","expanded","className","alt","loading","onLoad","Number","src","ellipsis","name","LoadingItem","ItemList","items","item","push","Section","FETCH_FAILED","FavoritesCategory","api","DB_API","settings","Settings","favorites","seen","abort","AbortController","data","set_favorites","state","get","game","test","console","warn","splice","indexOf","set","set_page","length","Component"],"sourceRoot":""}